# build options for NGen

[cmake](https://cmake.org/cmake/help/latest/manual/cmake.1.html) executable is the command-line interface of the cross-platform buildsystem generator CMake.

Look [here](https://cmake.org/cmake/help/latest/manual/cmake.1.html#options) for cmake options from the docs.

## Basic usage
Generate a project build system with: 

    cmake [<options>] -S <path-to-source> -B <path-to-build>
    
Example from NGen docker:

    cmake -B /ngen -S .

Build a project with:

    cmake --build <dir> [<options>] [-- <build-tool-options>]
    
Example from NGen docker:

    cmake --build /ngen --target ngen
    
The target option designates the object we wish to build into an executable.

## cmake Cache Entries

These options define how cmake builds NGen, which have implications on performance, which libraries are used, and the type of cmake build.

Create or update a CMake cache entry with:

    -D <var>:<type>=<value>, -D <var>=<value>
    
CMake cache entry can be thought of as a configuration file.
Example from /dmod/docker/main/ngen/Dockerfile: 

    cmake -B cmake_build_serial -S . -DMPI_ACTIVE:BOOL=OFF
    
## CMake CLI options

| CLI Argument | Preprocessor Definition | Options | Default | Notes |
| ------------- | ------------- | -----|-----| ---------- |
| [BMI_C_LIB_ACTIVE](/ngen/data/bmi/c) | NGEN_BMI_C_LIB_ACTIVE | TRUE/FALSE | FALSE | Use the [Basic Model Interface](https://bmi.readthedocs.io/en/latest/) C++ library. Strictly a preprocessor definition. |
| [BMI_FORTRAN_ACTIVE](/ngen/data/bmi/fortran) | NGEN_BMI_FORTRAN_ACTIVE | TRUE/FALSE | FALSE | Use the [Basic Model Interface](https://bmi.readthedocs.io/en/latest/) Fortran library. Strictly a preprocessor definition. |
| [CMAKE_BUILD_TYPE](https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html) | N/A | Debug, Release, RelWithDebInfo, MinSizeRel |  | From Cmake docs: Release: high optimization level, no debug info, code or asserts. Debug: No optimization, asserts enabled, [custom debug (output) code enabled], debug info included in executable (so you can step through the code with a debugger and have address to source-file:line-number translation). RelWithDebInfo: optimized, *with* debug info, but no debug (output) code or asserts. MinSizeRel: same as Release but optimizing for size rather than speed. |
| [CMAKE_C_COMPILER](https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_COMPILER.html) | N/A | {C compiler} | $CC | If not supplied at the command line, environment variable $CC is used, will error if $CC is not defined |
| [CMAKE_CXX_COMPILER](https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_COMPILER.html) | N/A | {CXX compiler} | $CXX | If not supplied at the command line, environment variable $CXX is used, will error if $CXX is not defined |
| [CMAKE_INSTALL_PREFIX](https://cmake.org/cmake/help/v3.0/variable/CMAKE_INSTALL_PREFIX.html) | N/A |  |  | If “make install” is invoked or INSTALL is built, this directory is prepended onto all install directories. This variable defaults to /usr/local on UNIX and c:/Program Files on Windows. |
| COVERAGE | N/A | TRUE/FALSE | FALSE | If TRUE, generates targets for creating code coverage reports for googletests |
| ET_QUIET | ET_QUIET | TRUE/FALSE | FALSE | If True, suppresses ET messages. Strictly a preprocessor definition. |
| [LSTM_TORCH_LIB_ACTIVE](https://pytorch.org/tutorials/advanced/cpp_frontend.html) | NGEN_LSTM_TORCH_LIB_ACTIVE | TRUE/FALSE | FALSE | If TRUE, includes the Torch package, which is the C++ distribution of PyTorch |
| [MPI_ACTIVE](/ngen/doc/MPI_REMOTE_NEXUS.md) | NGEN_MPI_ACTIVE | TRUE/FALSE | FALSE | If TRUE, includes the MPI package, which enables multi-processing. Also, selects the CMAKE_CXX_COMPILER to be mpicxx |
| [NETCDF_ACTIVE](http://unidata.github.io/netcdf-cxx4/index.html) | NETCDF_ACTIVE | TRUE/FALSE | FALSE | IF TRUE, includes the NetCDF package. |
| NGEN_ACTIVATE_PYTHON | ACTIVATE_PYTHON | TRUE/FALSE | FALSE | If True, includes the Python 3.6.8 package. |
| NGEN_ACTIVATE_ROUTING | NGEN_ROUTING_ACTIVE | TRUE/FALSE | FALSE |  Use Python based [t-routing](/ngen/doc/PYTHON_ROUTING.md). An appropriate `routing_config.yaml` must be passed to the NGen realization config. An [example configuration](ngen/data/ngen_routing.yaml) file is included in the example data. |
| NGEN_OUTPUT_ACTIVE | | TRUE/FALSE | TRUE | Disables all netcdf related code |
| NGEN_QUIET | NGEN_QUIET | TRUE/FALSE | FALSE | If True, suppresses ngen messages. Strictly a preprocessor definition. |
| TEST_FILE | N/A |  |  | Path to text file generated by [coverage_tools](https://github.com/JordanLaserGit/coverage_tools) |
| [UDUNITS_ACTIVE](https://www.unidata.ucar.edu/software/udunits) | N/A | TRUE/FALSE | TRUE | If TRUE, includes the UDUNITS2 package and sets the UDUNITS library to either the user supplied UDUNITS_LIBRARY or manually sets the library and dependencies |
| UDUNITS_QUIET | UDUNITS_QUIET | TRUE/FALSE | FALSE | If True, suppresses UDUNITS messages. Strictly a preprocessor definition. |
| QUIET | N/A | TRUE/FALSE | FALSE | Overrides UDUNITS_QUIET, ET_QUIET, and NGEN_QUIET to TRUE |


| NETCDF_INCLUDE_DIR | N/A |  | None | Path to the NetCDF include file |
| NETCDF_LIBRARY | N/A |  | None | NetCDF library |
| NETCDF_CXX_INCLUDE_DIR | N/A |  | None | Path to NetCDF C++ library |
| NETCDF_CXX_LIBRARY | N/A |  | None | NetCDF C++ library |
| UDUNITS_LIBRARY | N/A | {UDUNITS_LIBRARY} | None | If UDUNITS_ACTIVATE is TRUE, cmake will set the UDUNITS library to the UDUNITS_LIBRARY option value if defined |

## Non-Cmake CLI Docker ARGs
These are user defined docker ARGs used to build the docker image, but aren't directly used in the cmake build of ngen.

| ARG | Example | Notes |
| ------------- |-----| ------- |
| BRANCH | master | Which ngen branch to clone |
| [BOOST_VERSION](https://www.boost.org/) | 1.72.0 | Sets the version of boost to install. This is set as an environment variable when manually building without docker |
| [BUILD_CFE](/ngen/extern/cfe/README.md) | "true" | Build the [NOAA-OWP CFE](https://github.com/NOAA-OWP/cfe) module library |
| BUILD_NGEN_SERIAL | "true" | Build ngen without multi-processing |
| BUILD_NGEN_PARALLEL | "true" | Build ngen with multi-processing |
| [BUILD_NOAH_OWP](/ngen/extern/noah-owp-modular/README.md) | "true" | Build the [Noah-OWP](https://github.com/NOAA-OWP/noah-owp-modular) |
| BUILD_PARALLEL_JOBS |  |  |
| BUILD_PARTITIONER |"false"  | Not implemented |
| [BUILD_PET](/ngen/extern/evapotranspiration/README.md) | "true" | Build the [NOAA-OWP evapotranspiration](https://github.com/NOAA-OWP/evapotranspiration) model |
| [BUILD_TOPMODEL](/ngen/extern/topmodel/README.md) | "true" | Build the [NOAA-OWP topmodel](https://github.com/NOAA-OWP/topmodel) |
| DATASET_DIRECTORIES | "config forcing hydrofabric observation output" | Tells docker directories to make in /dmod/datasets/ |
| BUILD_SLOTH | "true" | Build the [NOAA-OWP SLoTH](https://github.com/NOAA-OWP/SLoTH) git submodule |
| COMMIT |  | ngen commit to checkout |
| FCFLAGS | "-w -fallow-argument-mismatch -O2" | Work around for MPI-Fortan issue |
| FFLAGS | "-w -fallow-argument-mismatch -O2" | Work around for MPI-Fortan issue |
| HD5_VERSION | 1.10.9 |  |
| MIN_PYTHON | "3.8.0" | Sets the earliest allowable python version |
| MIN_NUMPY | "1.18.0" | Sets the earliest allowable numpy version |
| MPICH_CONFIGURE_OPTIONS | "" |  |
| MPICH_MAKE_OPTIONS |  |  |
| [MPICH_VERSION](https://www.mpich.org/) | "3.2" | Sets the version of MPICH |
| NGEN_BUILD_CONFIG_TYPE | "Release" | Use to set CMAKE_BUILD_TYPE |
| [NETCDF_C_VERSION](https://docs.unidata.ucar.edu/netcdf-c/current/) | 4.8.1 |  |
| [NETCDF_CXX_VERSION](https://docs.unidata.ucar.edu/netcdf-cxx/current/) | 4.3.1 |  |
| [NETCDF_FORTRAN_VERSION](https://docs.unidata.ucar.edu/netcdf-fortran/current/) | 4.6.0 |  |
| REPO_URL | https://github.com/NOAA-OWP/ngen.git | URL of ngen.git to clone |
| [ROCKY_BASE_REQUIRED](https://rockylinux.org/) | "sudo openssh openssh-server bash git" | rockylinux base dependencies |
| ROCKY_NGEN_DEPS_REQUIRED | "sudo gcc gcc-c++ make cmake tar git gcc-gfortran libgfortran python39 python39-devel python39-pip bzip2 expat expat-devel flex bison udunits2 udunits2-devel zlib-devel" | ngen specific rockylinux dependencies |
| TROUTE_REPO_URL | https://github.com/NOAA-OWP/t-route.git | URL of t-route.git |
| TROUTE_BRANCH | ngen | Which t-route branch to clone |
| TROUTE_COMMIT |  | t-routing commit to checkout |
| WORKDIR | /ngen | Sets the working directory |

| REPOS |  |  |
| HYDRA_HOST_FILE |  |  |
| REQUIRE |  |  |
